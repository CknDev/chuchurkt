// Generated by LispyScript v1.0.0
var display = function(value) {
    return console.log(value);
};
var warn = function(value) {
    return console.warn(value);
};
var round = function(value) {
    return parseInt(value,10);
};
var f = function() {
    return false;
};
var list = function(...args) {
    return [
        ...args
    ];
};
var car = function(list) {
    return list[0];
};
var listen = function(name,fn) {
    return document.addEventListener(name,function(e) {
        return fn(e);
    });
};
var cdr = function(list) {
    return list.slice(1);
};
var $ = function(element) {
    return document.querySelector(element);
};
var ctx = function(canvas) {
    return canvas.getContext("2d");
};
var centerize = function(position,size) {
    var x = car(position);
    var y = car(cdr(position));
    var w = car(size);
    var h = car(cdr(size));
    return list(round((x + (w / 2))),round((y + (h / 2))));
};
var write = function(text,position,ctx) {
    ctx.font = "12px Verdana";
    var padd = (12 / 3);
    var x = (car(position) - padd);
    var y = (car(cdr(position)) + padd);
    return ctx.fillText(text,x,y);
};
var rect = function(position,size,ctx) {
    ctx.beginPath();
    return ctx.rect(car(position),car(cdr(position)),car(size),car(cdr(size)));
};
var stroke = function(ctx) {
    return ctx.stroke();
};
var background = function(color,ctx) {
    ctx.fillStyle = color;
    return ctx.fill();
};
var clr = function(w,h,ctx) {
    return ctx.clearRect(0,0,w,h);
};
var tilify = function(x,y,xMax,yMax,xTile,yTile,ctx) {
    rect(list(x,y),list(xTile,yTile),ctx);
    stroke(ctx);
    return ((x === xMax) ?
        ((y === yMax) ?
            false :
            tilify(0,(y + yTile),xMax,yMax,xTile,yTile,ctx)) :
        tilify((x + xTile),y,xMax,yMax,xTile,yTile,ctx));
};
var select = function(position,size,ctx) {
    rect(position,size,ctx);
    return background("green",ctx);
};
var moveSelect = function(currentDirection,padd,selectionBlock) {
    var direction = {
        UP: "UP",
        RIGHT: "RIGHT",
        DOWN: "DOWN",
        LEFT: "LEFT"
    };
    var x = car(selectionBlock);
    var y = car(cdr(selectionBlock));
    var xPadd = car(padd);
    var yPadd = car(cdr(padd));
    return ((currentDirection === direction.UP) ?
        list(x,(y - yPadd)) :
        ((currentDirection === direction.RIGHT) ?
            list((x + xPadd),y) :
            ((currentDirection === direction.DOWN) ?
                list(x,(y + yPadd)) :
                ((currentDirection === direction.LEFT) ?
                    list((x - xPadd),y) :
                    undefined))));
};
var MAX_ARROW = 4;
var hasMaxArrow = function(arrows) {
    return ((arrows === MAX_ARROW) ?
        true :
        false);
};
var arrowCounterAdd = function(currentCounter) {
    return (currentCounter + 1);
};
var arrowCounterSub = function(currentCounter) {
    return (currentCounter - 1);
};
var domArrowCounter = function(arrowCounter) {
    var el = $(".arrow-counter");
    el.innerHTML = arrowCounter;
};
var domArrowMax = function(max) {
    var el = $(".arrow-max");
    el.innerHTML = max;
};
var arrowSelect = function(currentDirection,image,sizeBlock,selectedBlock,arrowCounter,ctx) {
    var arrowTileSet = {
        UP: list(0,0,50,50),
        RIGHT: list(50,0,50,50),
        DOWN: list(100,0,50,50),
        LEFT: list(150,0,50,50)
    };
    var x = car(selectedBlock);
    var y = car(cdr(selectedBlock));
    [sx, sy, sw, sh] = arrowTileSet[currentDirection];
    [dw, dh] = sizeBlock;
    ctx.clearRect(x,y,dw,dh);
    ctx.drawImage(image,sx,sy,sw,sh,x,y,dw,dh);
    return arrowCounterAdd(arrowCounter);
};
var domSelectMode = function(currentMode) {
    var el = $(".select-mode");
    el.innerHTML = currentMode;
};
var toggleMode = function(currentMode) {
    var modes = list("navigation","arrow");
    ((currentMode === car(modes)) ?
        domSelectMode(car(cdr(modes))) :
        domSelectMode(car(modes)));
    return ((currentMode === car(modes)) ?
        car(cdr(modes)) :
        ((currentMode === car(cdr(modes))) ?
            car(modes) :
            undefined));
};
var fill = function(iteration,list) {
    return list.fill(iteration);
};
var length = function(list) {
    return list.length;
};
var keyboard = {
    UP: 38,
    RIGHT: 39,
    DOWN: 40,
    LEFT: 37,
    SPACE: 32
};
var arrowTileSet = list({
    UP: list(0,0,50,0)
},{
    RIGHT: list(50,0,50,0)
},{
    DOWN: list(100,0,50,0)
},{
    LEFT: list(150,0,50,0)
});
var selectMode = "navigation";
domSelectMode(selectMode);
var tileInit = function() {
    tileMap = new Image();
    tileMap.src = "./dist/assets/tileset.png";
    return tileMap;
};
var TILE_SIZE = list(25,15);
var WIN_WIDTH = 800;
var WIN_HEIGHT = 600;
var CANVAS_MAIN = $("canvas.main");
var CANVAS_GROUND = $("canvas.ground");
var CANVAS_SELECTION = $("canvas.selection");
var CANVAS_ARROW = $("canvas.arrow");
var block_size = TILE_SIZE;
var main = ctx(CANVAS_MAIN);
var ground = ctx(CANVAS_GROUND);
var selection = ctx(CANVAS_SELECTION);
var arrow = ctx(CANVAS_ARROW);
main.scale(1.0,1.0);
ground.scale(1.0,1.0);
selection.scale(1.0,1.0);
arrow.scale(1.0,1.0);
var spriteSheet = tileInit();
var clearMainCanvas = function() {
    return clr(CANVAS_MAIN.width,CANVAS_MAIN.height,main);
};
var clearSelectionCanvas = function() {
    return clr(CANVAS_SELECTION.width,CANVAS_SELECTION.height,selection);
};
tilify(0,0,WIN_WIDTH,WIN_HEIGHT,car(TILE_SIZE),car(cdr(TILE_SIZE)),ground);
var block_selected = list(0,0);
listen("keyup",function(e) {
    e.preventDefault();
    domArrowCounter(arrowCounter);
    ((e.keyCode === keyboard.SPACE) ?
        selectMode = toggleMode(selectMode) :
        undefined);
    ((selectMode === "navigation") ?
        ((e.keyCode === keyboard.UP) ?
            clearSelectionCanvas(block_selected = moveSelect("UP",block_size,block_selected)) :
            undefined)(((e.keyCode === keyboard.RIGHT) ?
            clearSelectionCanvas(block_selected = moveSelect("RIGHT",block_size,block_selected)) :
            undefined),((e.keyCode === keyboard.DOWN) ?
            clearSelectionCanvas(block_selected = moveSelect("DOWN",block_size,block_selected)) :
            undefined),((e.keyCode === keyboard.LEFT) ?
            clearSelectionCanvas(block_selected = moveSelect("LEFT",block_size,block_selected)) :
            undefined)) :
        undefined);
    ((selectMode === "arrow") ?
        ((true === hasMaxArrow(arrowCounter)) ?
            f() :
            ((e.keyCode === keyboard.UP) ?
                arrowCounter = arrowSelect("UP",spriteSheet,block_size,block_selected,arrowCounter,arrow) :
                ((e.keyCode === keyboard.RIGHT) ?
                    arrowCounter = arrowSelect("RIGHT",spriteSheet,block_size,block_selected,arrowCounter,arrow) :
                    ((e.keyCode === keyboard.DOWN) ?
                        arrowCounter = arrowSelect("DOWN",spriteSheet,block_size,block_selected,arrowCounter,arrow) :
                        ((e.keyCode === keyboard.LEFT) ?
                            arrowCounter = arrowSelect("LEFT",spriteSheet,block_size,block_selected,arrowCounter,arrow) :
                            undefined))))()) :
        undefined);
    return false;
});
var x = 0;
var arrowCounter = 0;
domArrowCounter(arrowCounter);
domArrowMax(MAX_ARROW);
var update = function() {
    return setInterval(function() {
        clearMainCanvas();
        ((x === 800) ?
            clearInterval(update) :
            undefined);
        rect(list(x,0),block_size,main);
        select(block_selected,block_size,selection);
        return background("red",main);
    },100);
};
spriteSheet.onload = function() {
    return update();
};
